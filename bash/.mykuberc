# vi: ft=sh

# Generic kubernetes stuff
alias k="kube-prompt"
alias kui="kubectl proxy"
alias kctxl="kubectl config get-contexts"
alias kdump='k8s-dump --apiserver-host=http://127.0.0.1:8001 --output=/home/antonio/'

kctx () {
  OPTIONS=`kubectl config get-contexts -o name`
  OPTIONS+=' EXIT'

  echo "Current context: `kubectl config current-context`"

  echo "Switch to which context? (or EXIT)"

  select opt in $OPTIONS; do
    if [ "$opt" = "EXIT" ]; then
      echo "Staying in the current context"
    else
      kubectl config use-context $opt
    fi
    break
  done
}

kns () {
  OPTIONS=`kubectl get namespaces -o name`
  OPTIONS+=' EXIT'

  CTX=`kubectl config current-context`

  echo "Current context: $CTX"
  echo "Current namespace: `kubectl config current-context`"

  echo "Switch to which namespace? (or EXIT)"

  select opt in $OPTIONS; do
    if [ "$opt" = "EXIT" ]; then
      echo "Staying in the current namespace"
    else
      NS=`echo $opt|sed 's/namespaces\///'`
      kubectl config set-context $CTX --namespace $NS
    fi
    break
  done
}

# Generic gcloud stuff
alias gcls="gcloud container clusters list"
alias glog="gcloud auth login --format='flattened' | grep -o '^access_token:.*' | tr -s ' ' | cut -d' ' -f2 | pbcopy"
alias gtok="cat ~/.kube/config | grep -o 'access-token:.*' | cut -d' ' -f2 | pbcopy"
